var e=(e,s,a)=>new Promise((t,r)=>{var i=e=>{try{l(a.next(e))}catch(s){r(s)}},n=e=>{try{l(a.throw(e))}catch(s){r(s)}},l=e=>e.done?t(e.value):Promise.resolve(e.value).then(i,n);l((a=a.apply(e,s)).next())});import{j as s}from"./ui-vendor-1ILoUzQc.js";import{k as a,a as t}from"./react-vendor-tk5Uqt6k.js";import{H as r,F as i}from"./Footer-5zBKrljn.js";import{B as n}from"./input-BIyE-_9q.js";import{C as l,a as d,b as c,d as o,e as m}from"./card-CzhgRBNg.js";import{B as x}from"./badge-7X2AGvQk.js";import{A as h,a as u}from"./alert-Cab3IIcR.js";import{s as j,b as p}from"./index-BqVvBisL.js";import{R as v,k as f,X as g,U as N,x as y,D as b,S as w,I as S,i as P,l as C,P as _,L as k,J as $}from"./utils-vendor-Cta_gFyS.js";import"./separator-CIcrb7B9.js";import"./auth-vendor-CP-4ZW6D.js";import"./query-vendor-BmgDZf4n.js";const D=()=>{const D=a(),[M,A]=t.useState("overview"),[E,U]=t.useState(null),[z,F]=t.useState(!0),[L,O]=t.useState(null),[R,q]=t.useState([]),[T,B]=t.useState(null),[G,I]=t.useState(!1),J=t.useCallback(()=>e(null,null,function*(){try{O(null);const{data:{user:s},error:a}=yield j.auth.getUser();if(a)return O({type:"auth",message:"Authentication error. Please log in again."}),void D("/login");if(!s)return void D("/login");U(s);try{const{data:e,error:a}=yield j.from("subscriptions").select("*").eq("user_id",s.id).order("created_at",{ascending:!1}).limit(1);a?(console.error("Error fetching subscription:",a),B(null)):B(e&&e.length>0?e[0]:null)}catch(e){console.error("Subscription fetch error:",e),B(null)}try{const{data:e,error:a}=yield j.from("payments").select("*").eq("user_id",s.id).order("created_at",{ascending:!1}).limit(10);a?(console.error("Error fetching payments:",a),q([])):q(e||[])}catch(e){console.error("Payments fetch error:",e),q([])}}catch(e){console.error("Dashboard data fetch error:",e),O({type:"network",message:"Failed to load dashboard data. Please try again."})}finally{F(!1),I(!1)}}),[D]),Y=t.useCallback(()=>e(null,null,function*(){I(!0),yield J(),E&&(yield p.trackActivity("dashboard_refresh",{refreshed_at:(new Date).toISOString()}))}),[J,E]);if(t.useEffect(()=>{J();const{data:{subscription:e}}=j.auth.onAuthStateChange((e,s)=>{"SIGNED_OUT"!==e&&s||D("/login")});return()=>e.unsubscribe()},[J,D]),z)return s.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),s.jsx("p",{children:"Loading dashboard..."})]})});const H=T?{name:T.plan_name||"Plan",price:"business"===T.plan_type?"$199":"$99",period:"/yr",renewsOn:T.end_date?`Renews/Ends on ${new Date(T.end_date).toLocaleDateString()}`:"",status:(T.status||"active").replace(/\b\w/g,e=>e.toUpperCase())}:{name:"Standard",price:"$49",period:"/month",renewsOn:"March 15, 2024",status:"Active"},K=R&&R.length>0?R.map(e=>({id:e.id,date:e.created_at?new Date(e.created_at).toLocaleDateString():"",amount:`${e.currency||"USD"} ${Number(e.amount||0).toFixed(2)}`,status:"completed"===(e.status||"").toString().toLowerCase()?"Paid":e.status||"Pending",description:`${e.plan_name||"Plan"}${e.plan_type?` - ${e.plan_type}`:""}`})):[{id:1,date:"Feb 15, 2024",amount:"$49.00",status:"Paid",description:"Standard Plan - Monthly"},{id:2,date:"Jan 15, 2024",amount:"$49.00",status:"Paid",description:"Standard Plan - Monthly"},{id:3,date:"Dec 15, 2023",amount:"$49.00",status:"Paid",description:"Standard Plan - Monthly"}];function Q({plan:e}){return s.jsxs(s.Fragment,{children:[s.jsxs(l,{children:[s.jsx(c,{children:s.jsxs(o,{className:"flex items-center gap-2",children:[s.jsx($,{className:"w-5 h-5"}),"Current Plan"]})}),s.jsxs(d,{children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.jsx("h3",{className:"text-xl font-semibold",children:e.name}),s.jsx(x,{variant:"secondary",children:e.status})]}),s.jsxs("p",{className:"text-muted-foreground",children:[e.price,e.period," ",e.renewsOn?`â€¢ ${e.renewsOn}`:""]})]}),s.jsx(n,{children:"Upgrade Plan"})]}),s.jsxs("div",{className:"grid md:grid-cols-3 gap-4 pt-4 border-t",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-primary",children:"15"}),s.jsx("div",{className:"text-sm text-muted-foreground",children:"Support Sessions"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-primary",children:"24/7"}),s.jsx("div",{className:"text-sm text-muted-foreground",children:"Monitoring"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-primary",children:"5"}),s.jsx("div",{className:"text-sm text-muted-foreground",children:"Devices Managed"})]})]})]})]}),s.jsxs(l,{children:[s.jsx(c,{children:s.jsx(o,{children:"Quick Actions"})}),s.jsx(d,{children:s.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[s.jsx(n,{variant:"outline",className:"h-auto p-4",children:s.jsxs("div",{className:"text-center",children:[s.jsx(b,{className:"w-6 h-6 mx-auto mb-2"}),s.jsx("div",{className:"font-medium",children:"Request Support"}),s.jsx("div",{className:"text-sm text-muted-foreground",children:"Get help with your devices"})]})}),s.jsx(n,{variant:"outline",className:"h-auto p-4",children:s.jsxs("div",{className:"text-center",children:[s.jsx(S,{className:"w-6 h-6 mx-auto mb-2"}),s.jsx("div",{className:"font-medium",children:"Download Remote Tool"}),s.jsx("div",{className:"text-sm text-muted-foreground",children:"Allow technician access"})]})})]})})]})]})}return s.jsxs("div",{className:"min-h-screen bg-background",children:[s.jsx(r,{}),s.jsxs("div",{className:"container py-8",children:[s.jsxs("div",{className:"mb-8",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Customer Dashboard"}),s.jsx("p",{className:"text-muted-foreground",children:"Manage your account and view support details"})]}),s.jsxs(n,{variant:"outline",size:"sm",onClick:Y,disabled:G,className:"flex items-center gap-2",children:[s.jsx(v,{className:"w-4 h-4 "+(G?"animate-spin":"")}),"Refresh"]})]}),L&&s.jsxs(h,{variant:"destructive",className:"mt-4",children:[s.jsx(f,{className:"h-4 w-4"}),s.jsxs(u,{className:"flex items-center justify-between",children:[s.jsx("span",{children:L.message}),s.jsx(n,{variant:"ghost",size:"sm",onClick:()=>O(null),className:"h-auto p-1",children:s.jsx(g,{className:"w-4 h-4"})})]})]})]}),s.jsxs("div",{className:"grid lg:grid-cols-4 gap-6",children:[s.jsx("div",{className:"lg:col-span-1",children:s.jsx(l,{children:s.jsx(d,{className:"p-4",children:s.jsxs("nav",{className:"space-y-2",children:[s.jsxs(n,{variant:"overview"===M?"default":"ghost",className:"w-full justify-start",onClick:()=>A("overview"),children:[s.jsx(N,{className:"w-4 h-4 mr-2"}),"Overview"]}),s.jsxs(n,{variant:"billing"===M?"default":"ghost",className:"w-full justify-start",onClick:()=>A("billing"),children:[s.jsx(y,{className:"w-4 h-4 mr-2"}),"Billing"]}),s.jsxs(n,{variant:"support"===M?"default":"ghost",className:"w-full justify-start",onClick:()=>A("support"),children:[s.jsx(b,{className:"w-4 h-4 mr-2"}),"Support"]}),s.jsxs(n,{variant:"settings"===M?"default":"ghost",className:"w-full justify-start",onClick:()=>A("settings"),children:[s.jsx(w,{className:"w-4 h-4 mr-2"}),"Settings"]})]})})})}),s.jsxs("div",{className:"lg:col-span-3 space-y-6",children:["overview"===M&&s.jsx(Q,{plan:H}),"billing"===M&&s.jsxs(s.Fragment,{children:[s.jsxs(l,{children:[s.jsxs(c,{children:[s.jsx(o,{children:"Payment History"}),s.jsx(m,{children:"View your billing history and download invoices"})]}),s.jsx(d,{children:s.jsx("div",{className:"space-y-4",children:K.map(e=>s.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[s.jsxs("div",{children:[s.jsx("div",{className:"font-medium",children:e.description}),s.jsx("div",{className:"text-sm text-muted-foreground",children:e.date})]}),s.jsxs("div",{className:"text-right",children:[s.jsx("div",{className:"font-medium",children:e.amount}),s.jsx(x,{variant:"Paid"===e.status?"secondary":"destructive",children:e.status})]}),s.jsx(n,{variant:"ghost",size:"sm",children:s.jsx(S,{className:"w-4 h-4"})})]},e.id))})})]}),s.jsxs(l,{children:[s.jsxs(c,{children:[s.jsx(o,{children:"Upgrade Your Plan"}),s.jsx(m,{children:"Get more features with our premium plans"})]}),s.jsx(d,{children:s.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"border rounded-lg p-4",children:[s.jsx("h3",{className:"font-semibold mb-2",children:"Premium Plan"}),s.jsxs("div",{className:"text-2xl font-bold mb-1",children:["$99",s.jsx("span",{className:"text-sm font-normal",children:"/month"})]}),s.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"24/7 priority support + advanced monitoring"}),s.jsx(n,{className:"w-full",children:"Upgrade to Premium"})]}),s.jsxs("div",{className:"border rounded-lg p-4",children:[s.jsx("h3",{className:"font-semibold mb-2",children:"Enterprise Plan"}),s.jsxs("div",{className:"text-2xl font-bold mb-1",children:["$199",s.jsx("span",{className:"text-sm font-normal",children:"/month"})]}),s.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Dedicated technician + unlimited devices"}),s.jsx(n,{variant:"outline",className:"w-full",children:"Contact Sales"})]})]})})]})]}),"support"===M&&s.jsxs(l,{children:[s.jsxs(c,{children:[s.jsx(o,{children:"Support Messages"}),s.jsx(m,{children:"Recent updates from our support team"})]}),s.jsx(d,{children:s.jsx("div",{className:"space-y-4",children:[{id:1,date:"Today",message:"Your system optimization is complete. Everything is running smoothly!",from:"Support Services"},{id:2,date:"Yesterday",message:"Scheduled maintenance completed successfully. No action required.",from:"System Admin"},{id:3,date:"3 days ago",message:"Monthly security scan completed. No threats detected.",from:"Security Team"}].map(e=>s.jsxs("div",{className:"border rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("div",{className:"font-medium",children:e.from}),s.jsx("div",{className:"text-sm text-muted-foreground",children:e.date})]}),s.jsx("p",{className:"text-sm",children:e.message})]},e.id))})})]}),"settings"===M&&s.jsxs(l,{children:[s.jsxs(c,{children:[s.jsx(o,{children:"Account Settings"}),s.jsx(m,{children:"Manage your account information and preferences"})]}),s.jsx(d,{className:"space-y-6",children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(P,{className:"w-5 h-5"}),s.jsxs("div",{children:[s.jsx("div",{className:"font-medium",children:"Email Address"}),s.jsx("div",{className:"text-sm text-muted-foreground",children:"customer@example.com"})]})]}),s.jsx(n,{variant:"outline",size:"sm",children:s.jsx(C,{className:"w-4 h-4"})})]}),s.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(_,{className:"w-5 h-5"}),s.jsxs("div",{children:[s.jsx("div",{className:"font-medium",children:"Phone Number"}),s.jsx("div",{className:"text-sm text-muted-foreground",children:"+1 (555) 123-4567"})]})]}),s.jsx(n,{variant:"outline",size:"sm",children:s.jsx(C,{className:"w-4 h-4"})})]}),s.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(k,{className:"w-5 h-5"}),s.jsxs("div",{children:[s.jsx("div",{className:"font-medium",children:"Password"}),s.jsx("div",{className:"text-sm text-muted-foreground",children:"Last changed 3 months ago"})]})]}),s.jsx(n,{variant:"outline",size:"sm",children:"Change"})]})]})})]})]})]})]}),s.jsx(i,{})]})};export{D as default};
