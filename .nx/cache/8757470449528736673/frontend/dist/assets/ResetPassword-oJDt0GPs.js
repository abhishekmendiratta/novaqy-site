var e=Object.defineProperty,s=Object.defineProperties,r=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,l=(s,r,a)=>r in s?e(s,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[r]=a,n=(e,s)=>{for(var r in s||(s={}))t.call(s,r)&&l(e,r,s[r]);if(a)for(var r of a(s))o.call(s,r)&&l(e,r,s[r]);return e},i=(e,a)=>s(e,r(a));import{j as c}from"./ui-vendor-CD6GsE3j.js";import{a as d,k as m,l as u,L as p}from"./react-vendor-tk5Uqt6k.js";import{B as h,I as w}from"./input-C59DobWj.js";import{L as x}from"./label-Umt57Zwy.js";import{C as j,b as f,d as g,e as v,a as y}from"./card-CFUHedji.js";import{A as b,a as N}from"./alert-BG3HNVY4.js";import{a as P,s as k}from"./index-CGNqy2AH.js";import{d as S,l as O,E as C,m as q}from"./utils-vendor-cIoDbW7Q.js";import"./auth-vendor-CP-4ZW6D.js";import"./query-vendor-D3F-YppS.js";const E=()=>{const[e,s]=d.useState(!1),[r,a]=d.useState(!1),[t,o]=d.useState({password:"",confirmPassword:""}),[l,E]=d.useState(!1),[Y,_]=d.useState(!1),[L,R]=d.useState([]),{toast:z}=P(),A=m(),[F]=u();d.useEffect(()=>{const e=F.get("access_token"),s=F.get("refresh_token");"recovery"===F.get("type")&&e&&s?k.auth.setSession({access_token:e,refresh_token:s}):e||(z({title:"Invalid reset link",description:"This password reset link is invalid or has expired. Please request a new one.",variant:"destructive"}),A("/login"))},[F,A,z]);return Y?c.jsx("div",{className:"min-h-screen bg-gradient-subtle flex items-center justify-center p-4",children:c.jsxs(j,{className:"w-full max-w-md",children:[c.jsxs(f,{className:"text-center",children:[c.jsx("div",{className:"mx-auto mb-4 flex h-12 w-12 items-center justify-center rounded-full bg-green-100",children:c.jsx(S,{className:"h-6 w-6 text-green-600"})}),c.jsx(g,{className:"text-2xl text-green-600",children:"Password Reset Successful!"}),c.jsx(v,{children:"Your password has been updated successfully. You will be redirected to the login page shortly."})]}),c.jsx(y,{className:"text-center",children:c.jsx(h,{onClick:()=>A("/login"),className:"w-full",children:"Go to Login"})})]})}):c.jsx("div",{className:"min-h-screen bg-gradient-subtle flex items-center justify-center p-4",children:c.jsxs("div",{className:"w-full max-w-md space-y-6",children:[c.jsx("div",{className:"text-center",children:c.jsxs(p,{to:"/",className:"inline-flex items-center space-x-2 mb-6",children:[c.jsx("img",{src:"/logo.png",alt:"Novaqy logo",className:"h-12 w-auto object-contain",loading:"eager",decoding:"async"}),c.jsx("span",{className:"text-2xl font-bold",children:"Novaqy"})]})}),c.jsxs(j,{children:[c.jsxs(f,{className:"text-center",children:[c.jsx(g,{className:"text-2xl",children:"Reset Your Password"}),c.jsx(v,{children:"Enter your new password below"})]}),c.jsxs(y,{className:"space-y-6",children:[L.length>0&&c.jsxs(b,{variant:"destructive",children:[c.jsx(O,{className:"h-4 w-4"}),c.jsx(N,{children:c.jsx("ul",{className:"list-disc list-inside space-y-1",children:L.map((e,s)=>c.jsx("li",{children:e},s))})})]}),c.jsxs("form",{onSubmit:e=>{return s=null,r=null,a=function*(){if(e.preventDefault(),R([]),t.password!==t.confirmPassword)return void R(["Passwords do not match"]);const s=(e=>{const s=[];return e.length<8&&s.push("Password must be at least 8 characters long"),/[A-Z]/.test(e)||s.push("Password must contain at least one uppercase letter"),/[a-z]/.test(e)||s.push("Password must contain at least one lowercase letter"),/\d/.test(e)||s.push("Password must contain at least one number"),/[!@#$%^&*()_+\-=[\]{};':"\\|,.<>?/]/.test(e)||s.push("Password must contain at least one special character"),{isValid:0===s.length,errors:s}})(t.password);if(s.isValid){E(!0);try{const{error:e}=yield k.auth.updateUser({password:t.password});if(e)throw e;_(!0),z({title:"Password updated successfully!",description:"Your password has been reset. You can now log in with your new password."}),setTimeout(()=>{A("/login")},3e3)}catch(r){console.error("Password reset error:",r),z({title:"Failed to reset password",description:r.message||"An error occurred while resetting your password. Please try again.",variant:"destructive"})}finally{E(!1)}}else R(s.errors)},new Promise((t,o)=>{var l=s=>{try{i(a.next(s))}catch(e){o(e)}},n=s=>{try{i(a.throw(s))}catch(e){o(e)}},i=e=>e.done?t(e.value):Promise.resolve(e.value).then(l,n);i((a=a.apply(s,r)).next())});var s,r,a},className:"space-y-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(x,{htmlFor:"password",children:"New Password"}),c.jsxs("div",{className:"relative",children:[c.jsx(w,{id:"password",type:e?"text":"password",value:t.password,onChange:e=>o(s=>i(n({},s),{password:e.target.value})),placeholder:"Enter your new password",required:!0}),c.jsx(h,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 hover:bg-transparent",onClick:()=>s(!e),children:e?c.jsx(C,{className:"h-4 w-4"}):c.jsx(q,{className:"h-4 w-4"})})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(x,{htmlFor:"confirmPassword",children:"Confirm New Password"}),c.jsxs("div",{className:"relative",children:[c.jsx(w,{id:"confirmPassword",type:r?"text":"password",value:t.confirmPassword,onChange:e=>o(s=>i(n({},s),{confirmPassword:e.target.value})),placeholder:"Confirm your new password",required:!0}),c.jsx(h,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 hover:bg-transparent",onClick:()=>a(!r),children:r?c.jsx(C,{className:"h-4 w-4"}):c.jsx(q,{className:"h-4 w-4"})})]})]}),c.jsx(h,{type:"submit",className:"w-full",disabled:l,children:l?"Updating Password...":"Update Password"})]}),c.jsxs("div",{className:"text-center text-sm",children:["Remember your password?"," ",c.jsx(p,{to:"/login",className:"text-primary hover:underline font-medium",children:"Back to login"})]})]})]})]})})};export{E as default};
