var e=(e,s,a)=>new Promise((t,r)=>{var n=e=>{try{l(a.next(e))}catch(s){r(s)}},i=e=>{try{l(a.throw(e))}catch(s){r(s)}},l=e=>e.done?t(e.value):Promise.resolve(e.value).then(n,i);l((a=a.apply(e,s)).next())});import{j as s}from"./ui-vendor-5WlL74oN.js";import{k as a,a as t}from"./react-vendor-tk5Uqt6k.js";import{H as r,F as n}from"./Footer-CdWCiMHY.js";import{B as i}from"./input-C5A1MEAn.js";import{C as l,a as d,b as c,d as o,e as m}from"./card-D1v2Sc5T.js";import{B as u}from"./badge-BzDkBdEQ.js";import{A as x,a as h}from"./alert-BGxRIcSd.js";import{s as j,a as p}from"./index-BJ0l41ru.js";import{s as v}from"./supabaseService-CL51qkd-.js";import{R as g,l as f,X as N,U as y,w as b,z as w,S,D as P,i as _,m as k,P as C,L as D,I as $}from"./utils-vendor-Ur4cPcm-.js";import"./separator-oPBfcbFj.js";import"./auth-vendor-CP-4ZW6D.js";import"./query-vendor-CWl5S8HH.js";const A=()=>{const A=a(),[F,M]=t.useState("overview"),[E,z]=t.useState(null),[O,U]=t.useState(!0),[R,L]=t.useState(null),[q,I]=t.useState([]),[T,G]=t.useState(null),[B,H]=t.useState(!1),[Y,J]=t.useState(!1),[Q,V]=t.useState(""),[K,W]=t.useState(!1),[X,Z]=t.useState([]),[ee,se]=t.useState(null),[ae,te]=t.useState([]),[re,ne]=t.useState(null),[ie,le]=t.useState(null),de=t.useCallback(()=>e(null,null,function*(){try{L(null);const{data:{user:s},error:a}=yield j.auth.getUser();if(a)return L({type:"auth",message:"Authentication error. Please log in again."}),void A("/login");if(!s)return void A("/login");z(s);try{const{data:e,error:a}=yield j.from("subscriptions").select("*").eq("user_id",s.id).order("created_at",{ascending:!1}).limit(1);a?(console.error("Error fetching subscription:",a),G(null)):G(e&&e.length>0?e[0]:null)}catch(e){console.error("Subscription fetch error:",e),G(null)}try{const{data:e,error:a}=yield j.from("payments").select("*").eq("user_id",s.id).order("created_at",{ascending:!1}).limit(10);a?(console.error("Error fetching payments:",a),I([])):I(e||[])}catch(e){console.error("Payments fetch error:",e),I([])}}catch(e){console.error("Dashboard data fetch error:",e),L({type:"network",message:"Failed to load dashboard data. Please try again."})}finally{U(!1),H(!1)}}),[A]),ce=t.useCallback(()=>e(null,null,function*(){H(!0),yield de(),E&&(yield p.trackActivity("dashboard_refresh",{refreshed_at:(new Date).toISOString()}))}),[de,E]);if(t.useCallback(()=>e(null,null,function*(){if(T&&E){W(!0);try{(yield v.cancelSubscription(T.id,Q))?(L(null),yield de(),yield p.trackSubscriptionChange(T.id,"cancelled"),J(!1),V("")):L({type:"data",message:"Failed to cancel subscription. Please try again."})}catch(e){console.error("Error cancelling subscription:",e),L({type:"network",message:"Failed to cancel subscription. Please check your connection."})}finally{W(!1)}}}),[T,E,Q,de]),t.useCallback(s=>e(null,null,function*(){A("/payment",{state:{upgrade:!0,currentPlan:null==T?void 0:T.plan_name,newPlan:s}}),yield p.trackActivity("plan_upgrade_initiated",{current_plan:null==T?void 0:T.plan_name,target_plan:s,initiated_at:(new Date).toISOString()})}),[T,A]),t.useEffect(()=>{de();const{data:{subscription:e}}=j.auth.onAuthStateChange((e,s)=>{"SIGNED_OUT"!==e&&s||A("/login")});return()=>e.unsubscribe()},[de,A]),O)return s.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),s.jsx("p",{children:"Loading dashboard..."})]})});const oe=T?{name:T.plan_name||"Plan",price:"business"===T.plan_type?"$199":"$99",period:"/yr",renewsOn:T.end_date?`Renews/Ends on ${new Date(T.end_date).toLocaleDateString()}`:"",status:(T.status||"active").replace(/\b\w/g,e=>e.toUpperCase())}:{name:"Standard",price:"$49",period:"/month",renewsOn:"March 15, 2024",status:"Active"},me=q&&q.length>0?q.map(e=>({id:e.id,date:e.created_at?new Date(e.created_at).toLocaleDateString():"",amount:`${e.currency||"USD"} ${Number(e.amount||0).toFixed(2)}`,status:"completed"===(e.status||"").toString().toLowerCase()?"Paid":e.status||"Pending",description:`${e.plan_name||"Plan"}${e.plan_type?` - ${e.plan_type}`:""}`})):[{id:1,date:"Feb 15, 2024",amount:"$49.00",status:"Paid",description:"Standard Plan - Monthly"},{id:2,date:"Jan 15, 2024",amount:"$49.00",status:"Paid",description:"Standard Plan - Monthly"},{id:3,date:"Dec 15, 2023",amount:"$49.00",status:"Paid",description:"Standard Plan - Monthly"}];function ue({plan:e}){return s.jsxs(s.Fragment,{children:[s.jsxs(l,{children:[s.jsx(c,{children:s.jsxs(o,{className:"flex items-center gap-2",children:[s.jsx($,{className:"w-5 h-5"}),"Current Plan"]})}),s.jsxs(d,{children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.jsx("h3",{className:"text-xl font-semibold",children:e.name}),s.jsx(u,{variant:"secondary",children:e.status})]}),s.jsxs("p",{className:"text-muted-foreground",children:[e.price,e.period," ",e.renewsOn?`â€¢ ${e.renewsOn}`:""]})]}),s.jsx(i,{children:"Upgrade Plan"})]}),s.jsxs("div",{className:"grid md:grid-cols-3 gap-4 pt-4 border-t",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-primary",children:"15"}),s.jsx("div",{className:"text-sm text-muted-foreground",children:"Support Sessions"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-primary",children:"24/7"}),s.jsx("div",{className:"text-sm text-muted-foreground",children:"Monitoring"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-primary",children:"5"}),s.jsx("div",{className:"text-sm text-muted-foreground",children:"Devices Managed"})]})]})]})]}),s.jsxs(l,{children:[s.jsx(c,{children:s.jsx(o,{children:"Quick Actions"})}),s.jsx(d,{children:s.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[s.jsx(i,{variant:"outline",className:"h-auto p-4",children:s.jsxs("div",{className:"text-center",children:[s.jsx(w,{className:"w-6 h-6 mx-auto mb-2"}),s.jsx("div",{className:"font-medium",children:"Request Support"}),s.jsx("div",{className:"text-sm text-muted-foreground",children:"Get help with your devices"})]})}),s.jsx(i,{variant:"outline",className:"h-auto p-4",children:s.jsxs("div",{className:"text-center",children:[s.jsx(P,{className:"w-6 h-6 mx-auto mb-2"}),s.jsx("div",{className:"font-medium",children:"Download Remote Tool"}),s.jsx("div",{className:"text-sm text-muted-foreground",children:"Allow technician access"})]})})]})})]})]})}return s.jsxs("div",{className:"min-h-screen bg-background",children:[s.jsx(r,{}),s.jsxs("div",{className:"container py-8",children:[s.jsxs("div",{className:"mb-8",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Customer Dashboard"}),s.jsx("p",{className:"text-muted-foreground",children:"Manage your account and view support details"})]}),s.jsxs(i,{variant:"outline",size:"sm",onClick:ce,disabled:B,className:"flex items-center gap-2",children:[s.jsx(g,{className:"w-4 h-4 "+(B?"animate-spin":"")}),"Refresh"]})]}),R&&s.jsxs(x,{variant:"destructive",className:"mt-4",children:[s.jsx(f,{className:"h-4 w-4"}),s.jsxs(h,{className:"flex items-center justify-between",children:[s.jsx("span",{children:R.message}),s.jsx(i,{variant:"ghost",size:"sm",onClick:()=>L(null),className:"h-auto p-1",children:s.jsx(N,{className:"w-4 h-4"})})]})]})]}),s.jsxs("div",{className:"grid lg:grid-cols-4 gap-6",children:[s.jsx("div",{className:"lg:col-span-1",children:s.jsx(l,{children:s.jsx(d,{className:"p-4",children:s.jsxs("nav",{className:"space-y-2",children:[s.jsxs(i,{variant:"overview"===F?"default":"ghost",className:"w-full justify-start",onClick:()=>M("overview"),children:[s.jsx(y,{className:"w-4 h-4 mr-2"}),"Overview"]}),s.jsxs(i,{variant:"billing"===F?"default":"ghost",className:"w-full justify-start",onClick:()=>M("billing"),children:[s.jsx(b,{className:"w-4 h-4 mr-2"}),"Billing"]}),s.jsxs(i,{variant:"support"===F?"default":"ghost",className:"w-full justify-start",onClick:()=>M("support"),children:[s.jsx(w,{className:"w-4 h-4 mr-2"}),"Support"]}),s.jsxs(i,{variant:"settings"===F?"default":"ghost",className:"w-full justify-start",onClick:()=>M("settings"),children:[s.jsx(S,{className:"w-4 h-4 mr-2"}),"Settings"]})]})})})}),s.jsxs("div",{className:"lg:col-span-3 space-y-6",children:["overview"===F&&s.jsx(ue,{plan:oe}),"billing"===F&&s.jsxs(s.Fragment,{children:[s.jsxs(l,{children:[s.jsxs(c,{children:[s.jsx(o,{children:"Payment History"}),s.jsx(m,{children:"View your billing history and download invoices"})]}),s.jsx(d,{children:s.jsx("div",{className:"space-y-4",children:me.map(e=>s.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[s.jsxs("div",{children:[s.jsx("div",{className:"font-medium",children:e.description}),s.jsx("div",{className:"text-sm text-muted-foreground",children:e.date})]}),s.jsxs("div",{className:"text-right",children:[s.jsx("div",{className:"font-medium",children:e.amount}),s.jsx(u,{variant:"Paid"===e.status?"secondary":"destructive",children:e.status})]}),s.jsx(i,{variant:"ghost",size:"sm",children:s.jsx(P,{className:"w-4 h-4"})})]},e.id))})})]}),s.jsxs(l,{children:[s.jsxs(c,{children:[s.jsx(o,{children:"Upgrade Your Plan"}),s.jsx(m,{children:"Get more features with our premium plans"})]}),s.jsx(d,{children:s.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"border rounded-lg p-4",children:[s.jsx("h3",{className:"font-semibold mb-2",children:"Premium Plan"}),s.jsxs("div",{className:"text-2xl font-bold mb-1",children:["$99",s.jsx("span",{className:"text-sm font-normal",children:"/month"})]}),s.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"24/7 priority support + advanced monitoring"}),s.jsx(i,{className:"w-full",children:"Upgrade to Premium"})]}),s.jsxs("div",{className:"border rounded-lg p-4",children:[s.jsx("h3",{className:"font-semibold mb-2",children:"Enterprise Plan"}),s.jsxs("div",{className:"text-2xl font-bold mb-1",children:["$199",s.jsx("span",{className:"text-sm font-normal",children:"/month"})]}),s.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Dedicated technician + unlimited devices"}),s.jsx(i,{variant:"outline",className:"w-full",children:"Contact Sales"})]})]})})]})]}),"support"===F&&s.jsxs(l,{children:[s.jsxs(c,{children:[s.jsx(o,{children:"Support Messages"}),s.jsx(m,{children:"Recent updates from our support team"})]}),s.jsx(d,{children:s.jsx("div",{className:"space-y-4",children:[{id:1,date:"Today",message:"Your system optimization is complete. Everything is running smoothly!",from:"Tech Support"},{id:2,date:"Yesterday",message:"Scheduled maintenance completed successfully. No action required.",from:"System Admin"},{id:3,date:"3 days ago",message:"Monthly security scan completed. No threats detected.",from:"Security Team"}].map(e=>s.jsxs("div",{className:"border rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("div",{className:"font-medium",children:e.from}),s.jsx("div",{className:"text-sm text-muted-foreground",children:e.date})]}),s.jsx("p",{className:"text-sm",children:e.message})]},e.id))})})]}),"settings"===F&&s.jsxs(l,{children:[s.jsxs(c,{children:[s.jsx(o,{children:"Account Settings"}),s.jsx(m,{children:"Manage your account information and preferences"})]}),s.jsx(d,{className:"space-y-6",children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(_,{className:"w-5 h-5"}),s.jsxs("div",{children:[s.jsx("div",{className:"font-medium",children:"Email Address"}),s.jsx("div",{className:"text-sm text-muted-foreground",children:"customer@example.com"})]})]}),s.jsx(i,{variant:"outline",size:"sm",children:s.jsx(k,{className:"w-4 h-4"})})]}),s.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(C,{className:"w-5 h-5"}),s.jsxs("div",{children:[s.jsx("div",{className:"font-medium",children:"Phone Number"}),s.jsx("div",{className:"text-sm text-muted-foreground",children:"+1 (555) 123-4567"})]})]}),s.jsx(i,{variant:"outline",size:"sm",children:s.jsx(k,{className:"w-4 h-4"})})]}),s.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(D,{className:"w-5 h-5"}),s.jsxs("div",{children:[s.jsx("div",{className:"font-medium",children:"Password"}),s.jsx("div",{className:"text-sm text-muted-foreground",children:"Last changed 3 months ago"})]})]}),s.jsx(i,{variant:"outline",size:"sm",children:"Change"})]})]})})]})]})]})]}),s.jsx(n,{})]})};export{A as default};
