var e=Object.defineProperty,r=Object.defineProperties,t=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,i=(r,t,n)=>t in r?e(r,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[t]=n,a=(e,r)=>{for(var t in r||(r={}))s.call(r,t)&&i(e,t,r[t]);if(n)for(var t of n(r))o.call(r,t)&&i(e,t,r[t]);return e},u=(e,r,t)=>new Promise((n,s)=>{var o=e=>{try{a(t.next(e))}catch(r){s(r)}},i=e=>{try{a(t.throw(e))}catch(r){s(r)}},a=e=>e.done?n(e.value):Promise.resolve(e.value).then(o,i);a((t=t.apply(e,r)).next())});import{l as c}from"./react-vendor-CU4acDdt.js";import{r as l,a as d}from"./auth-vendor-DvA6JlK5.js";import{s as p}from"./index-jEC04_G8.js";const m=c(l());var y,g={exports:{}};const f=c(y?g.exports:(y=1,g.exports=d().enc.Hex)),h={createPayment(e){return u(this,null,function*(){const{data:r,error:t}=yield p.from("payments").insert([e]).select().single();return t?(console.error("Error creating payment:",t),null):r})},updatePaymentStatus(e,r,t){return u(this,null,function*(){const n={status:r};t&&(n.payu_response=t);const{data:s,error:o}=yield p.from("payments").update(n).eq("transaction_id",e).select().single();return o?(console.error("Error updating payment:",o),null):s})},updatePaymentUserId(e,r){return u(this,null,function*(){const{data:t,error:n}=yield p.from("payments").update({user_id:r}).eq("transaction_id",e).select().single();return n?(console.error("Error updating payment user_id:",n),null):t})},getPaymentByTransactionId(e){return u(this,null,function*(){const{data:r,error:t}=yield p.from("payments").select("*").eq("transaction_id",e).single();return t?(console.error("Error fetching payment:",t),null):r})},getPaymentsByUserId(e){return u(this,null,function*(){const{data:r,error:t}=yield p.from("payments").select("*").eq("user_id",e).order("created_at",{ascending:!1});return t?(console.error("Error fetching payments:",t),[]):r||[]})}},_={createSubscription(e){return u(this,null,function*(){const{data:r,error:t}=yield p.from("subscriptions").insert([e]).select().single();return t?(console.error("Error creating subscription:",t),null):r})},getActiveSubscription(e){return u(this,null,function*(){const{data:r,error:t}=yield p.from("subscriptions").select("*").eq("user_id",e).eq("status","active").single();return t?(console.error("Error fetching subscription:",t),null):r})},updateSubscriptionStatus(e,r){return u(this,null,function*(){const{data:t,error:n}=yield p.from("subscriptions").update({status:r}).eq("id",e).select().single();return n?(console.error("Error updating subscription:",n),null):t})}},b={createAgreement(e){return u(this,null,function*(){const{data:r,error:t}=yield p.from("service_agreements").insert([e]).select().single();return t?(console.error("Error creating agreement:",t),null):r})},getAgreementsByUserId(e){return u(this,null,function*(){const{data:r,error:t}=yield p.from("service_agreements").select("*").eq("user_id",e).order("signed_at",{ascending:!1});return t?(console.error("Error fetching agreements:",t),[]):r||[]})}},v={processPaymentSuccess(e,n,s,o,i){return u(this,null,function*(){try{const l=yield h.updatePaymentStatus(e,"completed",n);if(!l)throw new Error("Failed to update payment");const{data:{user:d}}=yield p.auth.getUser();if(!d)return{user:null,payment:l,subscription:null};const m=yield h.updatePaymentUserId(e,d.id),y={user_id:d.id,payment_id:(null!=m?m:l).id,plan_name:o,plan_type:i,status:"active",start_date:(new Date).toISOString(),end_date:new Date(Date.now()+31536e6).toISOString(),auto_renew:!0},g=yield _.createSubscription(y);if(!g)throw new Error("Failed to create subscription");return{user:(u=a({},s),c={id:d.id},r(u,t(c))),payment:null!=m?m:l,subscription:g}}catch(l){return console.error("Error processing payment success:",l),null}var u,c})},saveServiceAgreement(e,r,t,n,s){return u(this,null,function*(){const o={user_id:e,subscription_id:r,agreement_text:t,signed_at:(new Date).toISOString(),ip_address:n,user_agent:s};return yield b.createAgreement(o)})}};export{m as S,v as a,f as e,h as p};
